<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hanthink.mon.model.MonPickPlanModel">

<!-- 取货单计划出货监控 -->
	<select id="queryOutPage"
		parameterType="com.hanthink.mon.model.MonPickPlanModel"
		resultType="com.hanthink.mon.model.MonPickPlanModel">
		SELECT A.SUPPLIER_NO supplierNo,
		E.SUPPLIER_NAME
		supplierName,
		F.WARE_CODE wareCode,
		G.WAREHOUSE_NAME warehouseName,
		WM_CONCAT(CASE
		WHEN TO_CHAR(A.PLAN_PICKUP_TIME, 'HH24') BETWEEN '02'
		AND '04' THEN
		CASE
		WHEN B.DELIVERY_TIME IS NULL THEN '未收货'
		WHEN
		A.PLAN_PICKUP_TIME - B.DELIVERY_TIME &lt; 0 THEN
		CASE
		WHEN D.ERROR_DATE
		+ (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &lt; 0 THEN
		'提前收'
		WHEN
		D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &gt;= 0 THEN
		'准时'
		END
		WHEN (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) = 0 THEN
		'准时'
		WHEN
		(A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &gt; 0 THEN
		'延迟收'
		END
		END)
		twoToFour,
		WM_CONCAT(CASE
		WHEN TO_CHAR(A.PLAN_PICKUP_TIME, 'HH24')
		BETWEEN '04' AND '06' THEN
		CASE
		WHEN B.DELIVERY_TIME IS NULL THEN '未收货'
		WHEN A.PLAN_PICKUP_TIME - B.DELIVERY_TIME &lt; 0 THEN
		CASE
		WHEN
		D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &lt; 0 THEN
		'提前收'
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &gt;=
		0 THEN
		'准时'
		END
		WHEN (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) = 0 THEN
		'准时'
		WHEN (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &gt; 0 THEN
		'延迟收'
		END
		END)
		fourToSix,
		WM_CONCAT(CASE
		WHEN TO_CHAR(A.PLAN_PICKUP_TIME, 'HH24')
		BETWEEN '06' AND '08' THEN
		CASE
		WHEN B.DELIVERY_TIME IS NULL THEN '未收货'
		WHEN A.PLAN_PICKUP_TIME - B.DELIVERY_TIME &lt; 0 THEN
		CASE
		WHEN
		D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &lt; 0 THEN
		'提前收'
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &gt;=
		0 THEN
		'准时'
		END
		WHEN (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) = 0 THEN
		'准时'
		WHEN (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &gt; 0 THEN
		'延迟收'
		END
		END)
		sixToEight,
		WM_CONCAT(CASE
		WHEN TO_CHAR(A.PLAN_PICKUP_TIME, 'HH24')
		BETWEEN '08' AND '10' THEN
		CASE
		WHEN B.DELIVERY_TIME IS NULL THEN '未收货'
		WHEN A.PLAN_PICKUP_TIME - B.DELIVERY_TIME &lt; 0 THEN
		CASE
		WHEN
		D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &lt; 0 THEN
		'提前收'
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &gt;=
		0 THEN
		'准时'
		END
		WHEN (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) = 0 THEN
		'准时'
		WHEN (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &gt; 0 THEN
		'延迟收'
		END
		END)
		eightToTen,
		WM_CONCAT(CASE
		WHEN TO_CHAR(A.PLAN_PICKUP_TIME, 'HH24')
		BETWEEN '10' AND '12' THEN
		CASE
		WHEN B.DELIVERY_TIME IS NULL THEN '未收货'
		WHEN A.PLAN_PICKUP_TIME - B.DELIVERY_TIME &lt; 0 THEN
		CASE
		WHEN
		D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &lt; 0 THEN
		'提前收'
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &gt;=
		0 THEN
		'准时'
		END
		WHEN (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) = 0 THEN
		'准时'
		WHEN (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &gt; 0 THEN
		'延迟收'
		END
		END)
		tenToTwelve,
		WM_CONCAT(CASE
		WHEN TO_CHAR(A.PLAN_PICKUP_TIME, 'HH24')
		BETWEEN '12' AND '14' THEN
		CASE
		WHEN B.DELIVERY_TIME IS NULL THEN '未收货'
		WHEN A.PLAN_PICKUP_TIME - B.DELIVERY_TIME &lt; 0 THEN
		CASE
		WHEN
		D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &lt; 0 THEN
		'提前收'
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &gt;=
		0 THEN
		'准时'
		END
		WHEN (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) = 0 THEN
		'准时'
		WHEN (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &gt; 0 THEN
		'延迟收'
		END
		END)
		twelveToFortee,
		WM_CONCAT(CASE
		WHEN TO_CHAR(A.PLAN_PICKUP_TIME, 'HH24')
		BETWEEN '14' AND '16' THEN
		CASE
		WHEN B.DELIVERY_TIME IS NULL THEN '未收货'
		WHEN A.PLAN_PICKUP_TIME - B.DELIVERY_TIME &lt; 0 THEN
		CASE
		WHEN
		D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &lt; 0 THEN
		'提前收'
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &gt;=
		0 THEN
		'准时'
		END
		WHEN (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) = 0 THEN
		'准时'
		WHEN (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &gt; 0 THEN
		'延迟收'
		END
		END)
		forteeToSixtee,
		WM_CONCAT(CASE
		WHEN TO_CHAR(A.PLAN_PICKUP_TIME, 'HH24')
		BETWEEN '16' AND '18' THEN
		CASE
		WHEN B.DELIVERY_TIME IS NULL THEN '未收货'
		WHEN A.PLAN_PICKUP_TIME - B.DELIVERY_TIME &lt; 0 THEN
		CASE
		WHEN
		D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &lt; 0 THEN
		'提前收'
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &gt;=
		0 THEN
		'准时'
		END
		WHEN (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) = 0 THEN
		'准时'
		WHEN (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &gt; 0 THEN
		'延迟收'
		END
		END)
		sixteeToEightee,
		WM_CONCAT(CASE
		WHEN TO_CHAR(A.PLAN_PICKUP_TIME, 'HH24')
		BETWEEN '18' AND '20' THEN
		CASE
		WHEN B.DELIVERY_TIME IS NULL THEN '未收货'
		WHEN A.PLAN_PICKUP_TIME - B.DELIVERY_TIME &lt; 0 THEN
		CASE
		WHEN
		D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &lt; 0 THEN
		'提前收'
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &gt;=
		0 THEN
		'准时'
		END
		WHEN (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) = 0 THEN
		'准时'
		WHEN (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &gt; 0 THEN
		'延迟收'
		END
		END)
		eighteeToTwentity,
		WM_CONCAT(CASE
		WHEN TO_CHAR(A.PLAN_PICKUP_TIME,
		'HH24') BETWEEN '20' AND '22' THEN
		CASE
		WHEN B.DELIVERY_TIME IS NULL
		THEN '未收货'
		WHEN A.PLAN_PICKUP_TIME - B.DELIVERY_TIME &lt; 0 THEN
		CASE
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &lt; 0 THEN
		'提前收'
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &gt;=
		0 THEN
		'准时'
		END
		WHEN (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) = 0 THEN
		'准时'
		WHEN (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &gt; 0 THEN
		'延迟收'
		END
		END)
		twentityToTwentityTwo,
		WM_CONCAT(CASE
		WHEN TO_CHAR(A.PLAN_PICKUP_TIME,
		'HH24:MI') BETWEEN '22:00' AND '23:59'
		THEN
		CASE
		WHEN B.DELIVERY_TIME IS
		NULL THEN '未收货'
		WHEN A.PLAN_PICKUP_TIME - B.DELIVERY_TIME &lt; 0 THEN
		CASE
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &lt; 0
		THEN
		'提前收'
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME)
		&gt;= 0 THEN
		'准时'
		END
		WHEN (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) = 0
		THEN
		'准时'
		WHEN (A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &gt; 0 THEN
		'延迟收'
		END
		END) tweneityTwoToZero,
		WM_CONCAT(CASE
		WHEN
		TO_CHAR(A.PLAN_PICKUP_TIME, 'HH24') BETWEEN '00' AND '02' THEN
		CASE
		WHEN B.DELIVERY_TIME IS NULL THEN '未收货'
		WHEN A.PLAN_PICKUP_TIME -
		B.DELIVERY_TIME &lt; 0 THEN
		CASE
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME
		- B.DELIVERY_TIME) &lt; 0 THEN
		'提前收'
		WHEN D.ERROR_DATE +
		(A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &gt;= 0 THEN
		'准时'
		END
		WHEN
		(A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) = 0 THEN
		'准时'
		WHEN
		(A.PLAN_PICKUP_TIME - B.DELIVERY_TIME) &gt; 0 THEN
		'延迟收'
		END
		END)
		zeroToTwo
		FROM MM_SW_PICKUP_PLAN A
		LEFT JOIN MM_SW_DELIVERY B
		ON
		A.PURCHASE_NO = B.PURCHASE_NO
		LEFT JOIN MM_SW_DELIVERY_DETAIL C
		ON
		B.DELIVERY_NO = C.DELIVERY_NO
		LEFT JOIN MM_MON_ALLOW_DEVIATION D
		ON
		A.ROUTE_CODE = D.ROUTE_CODE
		LEFT JOIN MM_PUB_SUPPLIER E
		ON A.SUPPLIER_NO
		= E.SUPPLIER_NO
		LEFT JOIN MM_PUP_ROUTE F
		ON A.ROUTE_CODE = F.ROUTE_CODE
		LEFT JOIN MM_PUB_WAREHOUSE G
		ON F.WARE_CODE = G.WAREHOUSE_ID
		WHERE
		TO_CHAR(A.PLAN_PICKUP_TIME, 'YYYY-MM-DD HH24:MI:SS') BETWEEN
		TO_CHAR(SYSDATE, 'YYYY-MM-DD') AND
		TO_CHAR(SYSDATE + 1, 'YYYY-MM-DD')
		<if test="supplierNo != null and '' != supplierNo">
			AND A.SUPPLIER_NO = #{supplierNo}
		</if>
		<if test="supplierName != null and '' != supplierName">
			AND A.SUPPLIER_NAME = #{supplierName}
		</if>
		<if test="wareCode != null and '' != wareCode">
			AND A.WARE_CODE = #{wareCode}
		</if>
		<if test="warehouseName != null and '' != warehouseName">
			AND A.WAREHOUSE_NAME = #{warehouseName}
		</if>
		GROUP BY A.SUPPLIER_NO, E.SUPPLIER_NAME, F.WARE_CODE, G.WAREHOUSE_NAME
	</select>
	
	<!-- 取货单计划出货监控明细 -->
	<select id="queryOutDetailPage"
		parameterType="com.hanthink.mon.model.MonPickPlanModel"
		resultType="com.hanthink.mon.model.MonPickPlanModel">
		SELECT A.ORDER_NO orderNo,
		A.PURCHASE_NO purchaseNo,
		A.SUPPLIER_NO supplierNo,
		B.SUPPLIER_NAME supplierName,
		C.WARE_CODE wareCode,
		D.WAREHOUSE_NAME warehouseName,
		TO_CHAR(A.PLAN_PICKUP_TIME, 'YYYY-MM-DD HH24:MI:SS') pickTime,
		TO_CHAR(E.DELIVERY_TIME, 'YYYY-MM-DD HH24:MI:SS') deliveryTime,
		F.PART_NO partNo,
		G.PART_NAME_CN partName,
		G.PART_SHORT_NO partShortNo,
		H.ORDER_QTY orderQty,
		H.TOTAL_REC_QTY totalRecQty,
		(CASE
		WHEN E.DELIVERY_TIME IS NULL THEN
		'未收货'
		WHEN A.PLAN_PICKUP_TIME - E.DELIVERY_TIME &lt; 0 THEN
		CASE
		WHEN I.ERROR_DATE + (A.PLAN_PICKUP_TIME - E.DELIVERY_TIME) &lt; 0 THEN
		'提前收'
		WHEN I.ERROR_DATE + (A.PLAN_PICKUP_TIME - E.DELIVERY_TIME) &gt;= 0 THEN
		'准时'
		END
		WHEN (A.PLAN_PICKUP_TIME - E.DELIVERY_TIME) = 0 THEN
		'准时'
		WHEN (A.PLAN_PICKUP_TIME - E.DELIVERY_TIME) &lt; 0 THEN
		'延迟收'
		END) status
		FROM MM_SW_PICKUP_PLAN A
		LEFT JOIN MM_PUB_SUPPLIER B
		ON A.SUPPLIER_NO = B.SUPPLIER_NO
		LEFT JOIN MM_PUP_ROUTE C
		ON A.ROUTE_CODE = C.ROUTE_CODE
		LEFT JOIN MM_PUB_WAREHOUSE D
		ON C.WARE_CODE = D.WAREHOUSE_ID
		LEFT JOIN MM_SW_DELIVERY E
		ON A.PURCHASE_NO = E.PURCHASE_NO
		LEFT JOIN MM_SW_DELIVERY_DETAIL F
		ON E.DELIVERY_NO = F.DELIVERY_NO
		<!-- i-LMS2019053001 mod by dtp -->
		LEFT JOIN MM_PUB_PART G
		ON F.PART_NO = G.PART_NO AND G.FACTORY_CODE = #{factoryCode}
		LEFT JOIN MM_SW_ORDER_DETAIL H
		ON A.PURCHASE_NO = H.PURCHASE_NO
		LEFT JOIN MM_MON_ALLOW_DEVIATION I
		ON A.ROUTE_CODE = I.ROUTE_CODE
		WHERE 1 = 1
		<if test="supplierNo != null and '' != supplierNo">
			AND A.SUPPLIER_NO = #{supplierNo}
		</if>
		<if test="wareCode != null and '' != wareCode">
			AND C.WARE_CODE = #{wareCode}
		</if>
		<if test="pickTime != null and '' != pickTime">
			AND TO_CHAR(A.PLAN_PICKUP_TIME, 'YYYY-MM-DD HH24:MI:SS') = #{pickTime}
		</if>
	</select>
	
	<!--取货单计划收获监控  -->
<select id="queryReceiptPage"
		parameterType="com.hanthink.mon.model.MonPickPlanModel"
		resultType="com.hanthink.mon.model.MonPickPlanModel">
		SELECT A.SUPPLIER_NO supplierNo,
		E.SUPPLIER_NAME
		supplierName,
		F.WARE_CODE wareCode,
		G.WAREHOUSE_NAME warehouseName,
		WM_CONCAT(CASE
		WHEN TO_CHAR(A.PLAN_PICKUP_TIME, 'HH24') BETWEEN '02'
		AND '04' THEN
		CASE
		WHEN B.REC_TIME IS NULL THEN '未收货'
		WHEN
		A.PLAN_PICKUP_TIME - B.REC_TIME &lt; 0 THEN
		CASE
		WHEN D.ERROR_DATE
		+ (A.PLAN_PICKUP_TIME - B.REC_TIME) &lt; 0 THEN
		'提前收'
		WHEN
		D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.REC_TIME) &gt;= 0 THEN
		'准时'
		END
		WHEN (A.PLAN_PICKUP_TIME - B.REC_TIME) = 0 THEN
		'准时'
		WHEN
		(A.PLAN_PICKUP_TIME - B.REC_TIME) &gt; 0 THEN
		'延迟收'
		END
		END)
		twoToFour,
		WM_CONCAT(CASE
		WHEN TO_CHAR(A.PLAN_PICKUP_TIME, 'HH24')
		BETWEEN '04' AND '06' THEN
		CASE
		WHEN B.REC_TIME IS NULL THEN '未收货'
		WHEN A.PLAN_PICKUP_TIME - B.REC_TIME &lt; 0 THEN
		CASE
		WHEN
		D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.REC_TIME) &lt; 0 THEN
		'提前收'
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.REC_TIME) &gt;=
		0 THEN
		'准时'
		END
		WHEN (A.PLAN_PICKUP_TIME - B.REC_TIME) = 0 THEN
		'准时'
		WHEN (A.PLAN_PICKUP_TIME - B.REC_TIME) &gt; 0 THEN
		'延迟收'
		END
		END)
		fourToSix,
		WM_CONCAT(CASE
		WHEN TO_CHAR(A.PLAN_PICKUP_TIME, 'HH24')
		BETWEEN '06' AND '08' THEN
		CASE
		WHEN B.REC_TIME IS NULL THEN '未收货'
		WHEN A.PLAN_PICKUP_TIME - B.REC_TIME &lt; 0 THEN
		CASE
		WHEN
		D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.REC_TIME) &lt; 0 THEN
		'提前收'
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.REC_TIME) &gt;=
		0 THEN
		'准时'
		END
		WHEN (A.PLAN_PICKUP_TIME - B.REC_TIME) = 0 THEN
		'准时'
		WHEN (A.PLAN_PICKUP_TIME - B.REC_TIME) &gt; 0 THEN
		'延迟收'
		END
		END)
		sixToEight,
		WM_CONCAT(CASE
		WHEN TO_CHAR(A.PLAN_PICKUP_TIME, 'HH24')
		BETWEEN '08' AND '10' THEN
		CASE
		WHEN B.REC_TIME IS NULL THEN '未收货'
		WHEN A.PLAN_PICKUP_TIME - B.REC_TIME &lt; 0 THEN
		CASE
		WHEN
		D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.REC_TIME) &lt; 0 THEN
		'提前收'
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.REC_TIME) &gt;=
		0 THEN
		'准时'
		END
		WHEN (A.PLAN_PICKUP_TIME - B.REC_TIME) = 0 THEN
		'准时'
		WHEN (A.PLAN_PICKUP_TIME - B.REC_TIME) &gt; 0 THEN
		'延迟收'
		END
		END)
		eightToTen,
		WM_CONCAT(CASE
		WHEN TO_CHAR(A.PLAN_PICKUP_TIME, 'HH24')
		BETWEEN '10' AND '12' THEN
		CASE
		WHEN B.REC_TIME IS NULL THEN '未收货'
		WHEN A.PLAN_PICKUP_TIME - B.REC_TIME &lt; 0 THEN
		CASE
		WHEN
		D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.REC_TIME) &lt; 0 THEN
		'提前收'
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.REC_TIME) &gt;=
		0 THEN
		'准时'
		END
		WHEN (A.PLAN_PICKUP_TIME - B.REC_TIME) = 0 THEN
		'准时'
		WHEN (A.PLAN_PICKUP_TIME - B.REC_TIME) &gt; 0 THEN
		'延迟收'
		END
		END)
		tenToTwelve,
		WM_CONCAT(CASE
		WHEN TO_CHAR(A.PLAN_PICKUP_TIME, 'HH24')
		BETWEEN '12' AND '14' THEN
		CASE
		WHEN B.REC_TIME IS NULL THEN '未收货'
		WHEN A.PLAN_PICKUP_TIME - B.REC_TIME &lt; 0 THEN
		CASE
		WHEN
		D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.REC_TIME) &lt; 0 THEN
		'提前收'
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.REC_TIME) &gt;=
		0 THEN
		'准时'
		END
		WHEN (A.PLAN_PICKUP_TIME - B.REC_TIME) = 0 THEN
		'准时'
		WHEN (A.PLAN_PICKUP_TIME - B.REC_TIME) &gt; 0 THEN
		'延迟收'
		END
		END)
		twelveToFortee,
		WM_CONCAT(CASE
		WHEN TO_CHAR(A.PLAN_PICKUP_TIME, 'HH24')
		BETWEEN '14' AND '16' THEN
		CASE
		WHEN B.REC_TIME IS NULL THEN '未收货'
		WHEN A.PLAN_PICKUP_TIME - B.REC_TIME &lt; 0 THEN
		CASE
		WHEN
		D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.REC_TIME) &lt; 0 THEN
		'提前收'
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.REC_TIME) &gt;=
		0 THEN
		'准时'
		END
		WHEN (A.PLAN_PICKUP_TIME - B.REC_TIME) = 0 THEN
		'准时'
		WHEN (A.PLAN_PICKUP_TIME - B.REC_TIME) &gt; 0 THEN
		'延迟收'
		END
		END)
		forteeToSixtee,
		WM_CONCAT(CASE
		WHEN TO_CHAR(A.PLAN_PICKUP_TIME, 'HH24')
		BETWEEN '16' AND '18' THEN
		CASE
		WHEN B.REC_TIME IS NULL THEN '未收货'
		WHEN A.PLAN_PICKUP_TIME - B.REC_TIME &lt; 0 THEN
		CASE
		WHEN
		D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.REC_TIME) &lt; 0 THEN
		'提前收'
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.REC_TIME) &gt;=
		0 THEN
		'准时'
		END
		WHEN (A.PLAN_PICKUP_TIME - B.REC_TIME) = 0 THEN
		'准时'
		WHEN (A.PLAN_PICKUP_TIME - B.REC_TIME) &gt; 0 THEN
		'延迟收'
		END
		END)
		sixteeToEightee,
		WM_CONCAT(CASE
		WHEN TO_CHAR(A.PLAN_PICKUP_TIME, 'HH24')
		BETWEEN '18' AND '20' THEN
		CASE
		WHEN B.REC_TIME IS NULL THEN '未收货'
		WHEN A.PLAN_PICKUP_TIME - B.REC_TIME &lt; 0 THEN
		CASE
		WHEN
		D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.REC_TIME) &lt; 0 THEN
		'提前收'
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.REC_TIME) &gt;=
		0 THEN
		'准时'
		END
		WHEN (A.PLAN_PICKUP_TIME - B.REC_TIME) = 0 THEN
		'准时'
		WHEN (A.PLAN_PICKUP_TIME - B.REC_TIME) &gt; 0 THEN
		'延迟收'
		END
		END)
		eighteeToTwentity,
		WM_CONCAT(CASE
		WHEN TO_CHAR(A.PLAN_PICKUP_TIME,
		'HH24') BETWEEN '20' AND '22' THEN
		CASE
		WHEN B.REC_TIME IS NULL
		THEN '未收货'
		WHEN A.PLAN_PICKUP_TIME - B.REC_TIME &lt; 0 THEN
		CASE
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.REC_TIME) &lt; 0 THEN
		'提前收'
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.REC_TIME) &gt;=
		0 THEN
		'准时'
		END
		WHEN (A.PLAN_PICKUP_TIME - B.REC_TIME) = 0 THEN
		'准时'
		WHEN (A.PLAN_PICKUP_TIME - B.REC_TIME) &gt; 0 THEN
		'延迟收'
		END
		END)
		twentityToTwentityTwo,
		WM_CONCAT(CASE
		WHEN TO_CHAR(A.PLAN_PICKUP_TIME,
		'HH24:MI') BETWEEN '22:00' AND '23:59'
		THEN
		CASE
		WHEN B.REC_TIME IS
		NULL THEN '未收货'
		WHEN A.PLAN_PICKUP_TIME - B.REC_TIME &lt; 0 THEN
		CASE
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.REC_TIME) &lt; 0
		THEN
		'提前收'
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME - B.REC_TIME)
		&gt;= 0 THEN
		'准时'
		END
		WHEN (A.PLAN_PICKUP_TIME - B.REC_TIME) = 0
		THEN
		'准时'
		WHEN (A.PLAN_PICKUP_TIME - B.REC_TIME) &gt; 0 THEN
		'延迟收'
		END
		END) tweneityTwoToZero,
		WM_CONCAT(CASE
		WHEN
		TO_CHAR(A.PLAN_PICKUP_TIME, 'HH24') BETWEEN '00' AND '02' THEN
		CASE
		WHEN B.REC_TIME IS NULL THEN '未收货'
		WHEN A.PLAN_PICKUP_TIME -
		B.REC_TIME &lt; 0 THEN
		CASE
		WHEN D.ERROR_DATE + (A.PLAN_PICKUP_TIME
		- B.REC_TIME) &lt; 0 THEN
		'提前收'
		WHEN D.ERROR_DATE +
		(A.PLAN_PICKUP_TIME - B.REC_TIME) &gt;= 0 THEN
		'准时'
		END
		WHEN
		(A.PLAN_PICKUP_TIME - B.REC_TIME) = 0 THEN
		'准时'
		WHEN
		(A.PLAN_PICKUP_TIME - B.REC_TIME) &gt; 0 THEN
		'延迟收'
		END
		END)
		zeroToTwo
		FROM MM_SW_PICKUP_PLAN A
		LEFT JOIN MM_INV_SW_REC B
		ON
		A.PURCHASE_NO = B.PURCHASE_NO
		LEFT JOIN MM_INV_SW_REC_DETAIL C
		ON
		B.REC_NO = C.REC_NO
		LEFT JOIN MM_MON_ALLOW_DEVIATION D
		ON
		A.ROUTE_CODE = D.ROUTE_CODE
		LEFT JOIN MM_PUB_SUPPLIER E
		ON A.SUPPLIER_NO
		= E.SUPPLIER_NO
		LEFT JOIN MM_PUP_ROUTE F
		ON A.ROUTE_CODE = F.ROUTE_CODE
		LEFT JOIN MM_PUB_WAREHOUSE G
		ON F.WARE_CODE = G.WAREHOUSE_ID
		WHERE
		TO_CHAR(A.PLAN_PICKUP_TIME, 'YYYY-MM-DD HH24:MI:SS') BETWEEN
		TO_CHAR(SYSDATE, 'YYYY-MM-DD') AND
		TO_CHAR(SYSDATE + 1, 'YYYY-MM-DD')
		<if test="supplierNo != null and '' != supplierNo">
			AND A.SUPPLIER_NO = #{supplierNo}
		</if>
		<if test="supplierName != null and '' != supplierName">
			AND A.SUPPLIER_NAME = #{supplierName}
		</if>
		<if test="wareCode != null and '' != wareCode">
			AND A.WARE_CODE = #{wareCode}
		</if>
		<if test="warehouseName != null and '' != warehouseName">
			AND A.WAREHOUSE_NAME = #{warehouseName}
		</if>
		GROUP BY A.SUPPLIER_NO, E.SUPPLIER_NAME, F.WARE_CODE, G.WAREHOUSE_NAME
	</select>
	<!-- 取货单计划收货监控明细 -->
	<select id="queryReceiptDetailPage"
		parameterType="com.hanthink.mon.model.MonPickPlanModel"
		resultType="com.hanthink.mon.model.MonPickPlanModel">
		SELECT A.ORDER_NO orderNo,
		A.PURCHASE_NO purchaseNo,
		A.SUPPLIER_NO supplierNo,
		B.SUPPLIER_NAME supplierName,
		C.WARE_CODE wareCode,
		D.WAREHOUSE_NAME warehouseName,
		TO_CHAR(A.PLAN_PICKUP_TIME, 'YYYY-MM-DD HH24:MI:SS') pickTime,
		TO_CHAR(E.REC_TIME, 'YYYY-MM-DD HH24:MI:SS') deliveryTime,
		F.PART_NO partNo,
		G.PART_NAME_CN partName,
		G.PART_SHORT_NO partShortNo,
		H.ORDER_QTY orderQty,
		H.TOTAL_REC_QTY totalRecQty,
		(CASE
		WHEN E.REC_TIME IS NULL THEN
		'未收货'
		WHEN A.PLAN_PICKUP_TIME - E.REC_TIME &lt; 0 THEN
		CASE
		WHEN I.ERROR_DATE + (A.PLAN_PICKUP_TIME - E.REC_TIME) &lt; 0 THEN
		'提前收'
		WHEN I.ERROR_DATE + (A.PLAN_PICKUP_TIME - E.REC_TIME) &gt;= 0 THEN
		'准时'
		END
		WHEN (A.PLAN_PICKUP_TIME - E.REC_TIME) = 0 THEN
		'准时'
		WHEN (A.PLAN_PICKUP_TIME - E.REC_TIME) &lt; 0 THEN
		'延迟收'
		END) status
		FROM MM_SW_PICKUP_PLAN A
		LEFT JOIN MM_PUB_SUPPLIER B
		ON A.SUPPLIER_NO = B.SUPPLIER_NO
		LEFT JOIN MM_PUP_ROUTE C
		ON A.ROUTE_CODE = C.ROUTE_CODE
		LEFT JOIN MM_PUB_WAREHOUSE D
		ON C.WARE_CODE = D.WAREHOUSE_ID
		LEFT JOIN MM_INV_SW_REC E
		ON A.PURCHASE_NO = E.PURCHASE_NO
		LEFT JOIN MM_INV_SW_REC_DETAIL F
		ON E.REC_NO = F.REC_NO
		<!-- i-LMS2019053001 mod by dtp -->
		LEFT JOIN MM_PUB_PART G
		ON F.PART_NO = G.PART_NO AND G.FACTORY_CODE = #{factoryCode}
		LEFT JOIN MM_SW_ORDER_DETAIL H
		ON A.PURCHASE_NO = H.PURCHASE_NO
		LEFT JOIN MM_MON_ALLOW_DEVIATION I
		ON A.ROUTE_CODE = I.ROUTE_CODE
		WHERE 1 = 1
		<if test="supplierNo != null and '' != supplierNo">
			AND A.SUPPLIER_NO = #{supplierNo}
		</if>
		<if test="wareCode != null and '' != wareCode">
			AND C.WARE_CODE = #{wareCode}
		</if>
		<if test="pickTime != null and '' != pickTime">
			AND TO_CHAR(A.PLAN_PICKUP_TIME, 'YYYY-MM-DD HH24:MI:SS') = #{pickTime}
		</if>
	</select>
</mapper>